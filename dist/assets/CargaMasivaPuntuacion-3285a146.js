import{r as n,A as Z,_ as K,b as z,c as I,d as p,e as P,j as e,O as Q,B as M}from"./index-aff8c025.js";import{U as f}from"./UtilService-9f1161d4.js";import{E as W}from"./ExcelService-e5139f15.js";import{F as c,C as b}from"./index-aa3aee1a.js";import{T as X}from"./index-a63b03f4.js";import{T as L}from"./index-ed149759.js";import{I as R}from"./index-3fdb4488.js";import{S as y,P as Y,C as ee}from"./index-54e651da.js";import{R as E}from"./row-0e000846.js";import{A as T}from"./index-2df60e21.js";import{I as te,U as ae,m as se}from"./index-7ff15e56.js";import"./EditOutlined-232863e3.js";import"./styleChecker-5146645c.js";import"./TextArea-97b9cd34.js";import"./BaseInput-08586a27.js";import"./context-5f51aab9.js";import"./useForceUpdate-a70ac771.js";import"./EyeOutlined-9f393984.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const re=oe;var ne=function(u,i){return n.createElement(Z,K({},u,{ref:i,icon:re}))},ie=n.forwardRef(ne);const ce=ie,le=s=>{const u=z(),[i,w]=n.useState([]),[h,C]=n.useState([]),[m,v]=n.useState({contador:null,sumatoria:null}),[j]=c.useForm();n.useEffect(()=>{s.status&&k()},[s.status]);const k=()=>{u(I()),f.obtenerLogrosAprendizajeDocente(s.datos).then(l=>{w(l.data.data),C(l.data.configuracion)}).catch(l=>{u(p({success:!1,title:"Error al obtener los periodos",message:l.response.data.error}))}).finally(()=>u(P()))},S=()=>{s.close(),j.setFieldsValue({puntuacion:[]}),v({contador:null,sumatoria:null})},A=(l,r)=>{var d,g;v({contador:(d=r==null?void 0:r.puntuacion)==null?void 0:d.length,sumatoria:(g=r==null?void 0:r.puntuacion)==null?void 0:g.filter(o=>(o==null?void 0:o.puntuacion)!==void 0).reduce((o,x)=>o+x.puntuacion,0)})},O=l=>{u(I()),W.descargarFormatoPuntuacion({...l,datos:s.datos}).then(async r=>{const d=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),g=window.URL.createObjectURL(d),o=document.createElement("a");o.href=g,o.download=`LOGROS_APRENDIZAJE_${s.datosLabel.periodo}_${s.datosLabel.materia}_${s.datosLabel.docente}.xlsx`,document.body.appendChild(o),o.click(),o.remove()}).catch(r=>{u(p({success:!1,title:"Error al obtener los periodos",message:r.response.data.error}))}).finally(()=>u(P()))},D=()=>{const l=j.getFieldsValue().puntuacion.map((r,d)=>({...r,pregunta:d+1}));j.setFieldsValue({puntuacion:l})};return e.jsxs(Q,{open:s.status,title:"Asignacion de puntos",style:{userSelect:"none"},onCancel:S,footer:!1,children:[m.contador>0&&m.contador!==null&&e.jsxs(e.Fragment,{children:[e.jsxs(X,{color:h.puntuacion<m.sumatoria?"red":h.puntuacion>m.sumatoria?"gold":"green",children:["Puntuacion total: ",m.sumatoria]}),h.puntuacion<m.sumatoria?e.jsx(L.Text,{type:"danger",children:"Te pasaste!"}):h.puntuacion>m.sumatoria?e.jsx(L.Text,{type:"warning",children:"Faltan puntos"}):e.jsx(L.Text,{type:"success",children:"Excelente!"})]}),e.jsxs(c,{form:j,onValuesChange:A,onFinish:O,children:[e.jsx(c.List,{name:"puntuacion",children:(l,{add:r,remove:d})=>e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",marginBlock:"20px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e6f4ff"},children:[e.jsx("th",{style:{border:"1px dotted #91caff"},children:"N° Pregunta"}),e.jsx("th",{style:{border:"1px dotted #91caff"},children:"Logro de aprendizaje"}),e.jsx("th",{colSpan:2,style:{border:"1px dotted #91caff"},children:"Puntuacion"})]})}),e.jsx("tbody",{children:l.map(({key:g,name:o,...x})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(c.Item,{...x,name:[o,"pregunta"],children:e.jsx(R,{readOnly:!0})})}),e.jsx("td",{children:e.jsx(c.Item,{...x,name:[o,"logro"],children:e.jsx(y,{style:{width:"100%"},placeholder:"Seleccione un logro...",options:i})})}),e.jsx("td",{children:e.jsx(c.Item,{...x,name:[o,"puntuacion"],children:e.jsx(R,{style:{width:"100%"},placeholder:"Ingrese un puntaje"})})}),e.jsx("td",{style:{width:"40px",height:"30px",display:"flex",justifyContent:"center",alignContent:"center"},children:e.jsx(ce,{onClick:()=>d(o)})})]}))})]}),e.jsx(c.Item,{children:e.jsx(M,{type:"dashed",onClick:()=>{r(),D()},block:!0,icon:e.jsx(Y,{}),children:"Agregar campo"})})]})}),e.jsxs(E,{justify:"end",children:[e.jsx(M,{type:"primary",disabled:h.puntuacion!==m.sumatoria,style:{marginInline:"10px"},htmlType:"submit",children:"Descargar formato"}),e.jsx(M,{onClick:S,children:"Cerrar"})]})]})]})},we=()=>{const[s]=c.useForm(),{Dragger:u}=ae,i=z(),[w,h]=n.useState([]),[C,m]=n.useState([]),[v,j]=n.useState([]),[k,S]=n.useState([]),[A,O]=n.useState([]),[D,l]=n.useState([]),[r,d]=n.useState({}),[g,o]=n.useState(!1);n.useEffect(()=>{s.setFieldsValue({materias:A})},[A]);const x=()=>{i(I()),f.getComboCarreras().then(t=>{t.data.ok&&h(t.data.data)}).catch(t=>{i(p({success:!1,title:"Error al asignar los logros",message:t.response.data.error}))}).finally(()=>i(P()))},B=()=>{s.resetFields(["docente","grupo"]);const t=s.getFieldsValue();f.obtenerDocentesPeriodoCarrera(t).then(a=>{a.data.ok&&m(a.data.data)}).catch(a=>{i(p({success:!1,title:"Error al obtener los docentes",message:a.response.data.error}))})},N=t=>{s.resetFields(["docente","grupo","materia","periodos"]),f.obtenerPeriodoNominaCarreraDocenteMateriaConEstudiantes(t).then(a=>{a.data.ok&&j(a.data.data)}).catch(a=>{i(p({success:!1,title:"Error al obtener los periodos",message:a.response.data.error}))})},U=()=>{s.resetFields(["docente","grupo","materia"]);const t=s.getFieldsValue();f.obtenerMaterias(t).then(a=>{a.data.ok&&S(a.data.data)}).catch(a=>{i(p({success:!1,title:"Error al obtener las materias",message:a.response.data.error}))}).finally(()=>{})},G=()=>{s.resetFields(["grupo"]);const t=s.getFieldsValue();f.obtenerGruposDocenteMateria(t).then(a=>{l(a.data.data)}).catch(a=>{i(p({success:!1,title:"Error al obtener los grupos",message:a.response.data.error}))})},_=({file:t,onSuccess:a})=>{a("ok"),se.success(`${t.name} cargado exitosamente.`)};n.useEffect(()=>{x()},[]);const $={name:"file",multiple:!1,maxCount:1,onRemove:()=>{d({})},accept:".xls,.xlsx",onChange:t=>{if(t.file.status==="removed")return;const a=t.file.originFileObj;d(a)},customRequest:_},q=()=>{i(I()),f.subirAsignacionPuntosMasiva({file:r}).then(t=>{t.data.ok&&(s.resetFields(),d({}),O([]),S([]),i(p({success:!0,title:"Puntuacion asignada correctamente"})))}).catch(t=>{i(p({success:!1,title:"Error al asignar puntuacion a los logros",message:t.response.data.error}))}).finally(()=>i(P()))},V=()=>{const t=s.getFieldsValue(),a=t.docente&&C.filter(F=>F.value===t.docente)[0].label,H=t.materia&&k.filter(F=>F.value===t.materia)[0].label,J=t.periodos&&v.filter(F=>F.value===t.periodos)[0].label;return{docente:a,materia:H,periodo:J}};return e.jsxs("div",{children:[e.jsx(le,{status:g,datos:s.getFieldsValue(),datosLabel:V(),close:()=>o(!1)}),e.jsx("h2",{children:"Puntuacion de los logros de aprendizaje"}),e.jsxs(ee,{children:[e.jsx(T,{style:{marginBlock:"10px"},message:"Aqui se descargara el formato de los estudiantes inscritos por materia y docentes(Opcional)",showIcon:!0,type:"info"}),e.jsxs(c,{form:s,layout:"vertical",onFinish:()=>o(!0),children:[e.jsxs(E,{justify:"space-between",children:[e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Carreras",name:"carrera",children:e.jsx(y,{placeholder:"Seleccione una carrera...",options:w,onChange:N})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Periodos",name:"periodos",children:e.jsx(y,{placeholder:"Seleccione un periodo...",options:v,onChange:U})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Materia",name:"materia",children:e.jsx(y,{maxTagCount:"responsive",placeholder:"Seleccione una materia...",options:k,onChange:B})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Docente",name:"docente",rules:[{required:!0,message:"Debe seleccionar un docente"}],children:e.jsx(y,{maxTagCount:"responsive",placeholder:"Seleccione un docente...",onChange:G,options:C})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Grupo",name:"grupo",rules:[{required:!0,message:"Debe seleccionar un grupo"}],children:e.jsx(y,{maxTagCount:"responsive",placeholder:"Seleccione un grupo...",options:D})})})]}),e.jsxs(E,{justify:"end",style:{marginBlock:"30px"},children:[e.jsx(M,{htmlType:"submit",disabled:!C.length>0,type:"primary",children:"Asignar puntuación"}),e.jsx(M,{onClick:q,disabled:!Object.keys(r).length>0,type:"primary",children:"Subir documento"})]}),e.jsx(E,{children:e.jsx(b,{style:{width:"100%"},children:e.jsxs(u,{...$,children:[e.jsx(T,{style:{marginBlock:"10px"},message:"Una vez llenado el formato, suba el archivo para ingresar los datos al sistema.",showIcon:!0,type:"warning"}),e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(te,{})}),e.jsx("p",{className:"ant-upload-text",children:"Haga clic o arrastre el archivo a esta área para cargarlo"}),e.jsx("p",{className:"ant-upload-hint",children:"Solo permite subir un solo archivo archivo de tipo excel"})]})})})]})]})]})};export{we as default};
