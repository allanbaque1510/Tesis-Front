import{r as i,b as Z,j as e,B as O,c as f,d as g,e as x}from"./index-15240922.js";import{F as ee,S as y}from"./html2canvas.esm-a5085a31.js";import{h as ae}from"./html2pdf-19a8da04.js";import{U as u}from"./UtilService-4db337ed.js";import{E as te}from"./ExcelService-2ca9fc3b.js";import{F as h,C as c}from"./index-5590f4ee.js";import{R as l}from"./row-5d227883.js";import{C as m,S as R,E as A}from"./index-6ab464cc.js";import{T as n}from"./index-ec864326.js";import{T as oe}from"./Table-b4bf00f1.js";import{F as re}from"./FileExcelOutlined-1d83c243.js";import{T as _}from"./TeamOutlined-67d7b0f1.js";import{C as se}from"./index-54adf267.js";import"./useForceUpdate-d8c4c42e.js";import"./EditOutlined-ea388460.js";import"./styleChecker-bc4901ce.js";import"./TextArea-a7b7f909.js";import"./BaseInput-d53a2d9c.js";import"./scrollTo-528c30a2.js";import"./index-be7a82b5.js";import"./EyeOutlined-f74af4a3.js";import"./index-d45f498e.js";const we=()=>{var S,v,w,k,P,D,I;const[C,N]=i.useState([]),[T,z]=i.useState([]),[V,B]=i.useState([]),[t,E]=i.useState({}),[G,L]=i.useState([]),[d,U]=i.useState({}),F=i.useRef(),W=()=>{const a=F.current,o={filename:"Tasa_Reprobados "+d.carrera.label+" _ "+d.periodo.label+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,dpi:192,letterRendering:!0},jsPDF:{unit:"in",format:[13,9],orientation:"landscape"}};ae().from(a).set(o).save()},[p]=h.useForm(),s=Z(),$=a=>{u.obtenerComboPeriodoReprobados({id_carrera:a}).then(o=>{o.data.ok&&N(o.data.data)})},q=()=>{u.getComboCarreras().then(a=>{a.data.ok&&z(a.data.data)})},H=a=>{s(f());const o=p.getFieldsValue(),j=T.filter(r=>r.value===o.carrera)[0],b=C.filter(r=>r.value===o.periodo)[0];U({carrera:j,periodo:b}),u.obtenerReprobadosMateriaPorcentaje(o).then(r=>{r.data.ok&&(B(r.data.data.sort((X,Y)=>Y.porcentaje-X.porcentaje)),E(r.data.mas_reprobado),L(r.data.materias),p.setFieldsValue({materia:r.data.mas_reprobado.materia.id_materia}))}).catch(r=>{s(g({success:!1,title:"Error al obtener datos",message:r.response.data.error}))}).finally(()=>s(x()))};i.useEffect(()=>{q()},[]);const J=()=>{s(f());const a=p.getFieldsValue();u.obtenerReprobadoMateriaDetallePorcentaje(a).then(o=>{o.data.ok&&E(o.data.data)}).catch(o=>{s(g({success:!1,title:"Error al obtener datos",message:o.response.data.error}))}).finally(()=>s(x()))},K=()=>{s(f());const a=p.getFieldsValue();te.descargarExcelTasaReprobados(a).then(async o=>{const j=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=window.URL.createObjectURL(j),r=document.createElement("a");r.href=b,r.download=`REPORTE_TASA_REPROBADOS_${d.carrera.label} _ ${d.periodo.label}.xlsx`,document.body.appendChild(r),r.click(),r.remove()}).catch(o=>{s(g({success:!1,title:"Error al descargar el reporte",message:o.response.data.error}))}).finally(()=>s(x()))},M=[{align:"left",key:"materia",dataIndex:"materia",title:"Materia"},{align:"center",key:"totalEstudiantes",dataIndex:"totalEstudiantes",title:"Cantidad Estudiantes"},{align:"right",key:"cantidad",dataIndex:"cantidad",title:"Total Reprobados"},{align:"right",key:"cantidadAsistencia",dataIndex:"cantidadAsistencia",title:"Reprobados por asistencia"},{align:"center",key:"cantidadNota",dataIndex:"cantidadNota",title:"Reprobados por promedio"},{align:"center",key:"porcentaje",dataIndex:"porcentaje",title:"Porcentaje",render:a=>`${a}%`}],Q=(S=t==null?void 0:t.data)==null?void 0:S.map(a=>[{grupo:a==null?void 0:a.grupo,name:"Reprobados por nota",value:a.cantidadNota},{grupo:a==null?void 0:a.grupo,name:"Reprobados por asistencia",value:a.cantidadAsistencia}]).flat();return e.jsxs("div",{children:[e.jsx("h2",{children:"Indicador Tasa de Reprobados (Porcentajes)"}),e.jsxs(h,{form:p,layout:"vertical",children:[e.jsx(l,{children:e.jsxs(m,{style:{width:"100%"},children:[e.jsxs(l,{justify:"space-around",children:[e.jsx(c,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(h.Item,{label:"Carrera",name:"carrera",children:e.jsx(R,{placeholder:"Seleccione una carrera",options:T,onChange:a=>{$(a)}})})}),e.jsx(c,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(h.Item,{label:"Periodo",name:"periodo",children:e.jsx(R,{placeholder:"Seleccione un periodo",options:C,onChange:a=>{H()}})})})]}),Object.keys(t).length>0&&e.jsxs(l,{justify:"end",children:[e.jsx(O,{icon:e.jsx(re,{}),type:"primary",onClick:K,className:"botonExcel",children:"Descargar reporte"}),e.jsx(O,{icon:e.jsx(ee,{}),type:"primary",onClick:W,className:"botonPdf",children:"Descargar PDF"})]})]})}),e.jsxs(m,{title:"Reprobados",children:[Object.keys(t).length>0&&e.jsx(h.Item,{name:"materia",label:"Materia",children:e.jsx(R,{style:{width:"300px"},placeholder:"Seleccione una materia",options:G,onChange:J})}),e.jsx(m,{ref:F,bordered:!1,title:e.jsxs(e.Fragment,{children:[(v=d.carrera)==null?void 0:v.label," ",e.jsx("span",{style:{marginInline:"15px"}})," ",(w=d.periodo)==null?void 0:w.label,"  ",e.jsx("span",{style:{marginInline:"15px"}})," ",(k=t==null?void 0:t.materia)==null?void 0:k.materia]}),children:e.jsxs(l,{justify:"space-between",children:[e.jsx(c,{xs:24,sm:24,md:24,lg:11,xl:11,children:Object.keys(t).length>0?e.jsxs(m,{children:[e.jsx(m.Grid,{style:{width:"100%",backgroundColor:"#0161DA"},children:e.jsxs(l,{justify:"space-between",children:[e.jsxs(c,{children:[e.jsx(n.Title,{style:{color:"white"},level:3,children:"Total de estudiantes "}),e.jsxs(l,{justify:"space-between",children:[e.jsxs(n.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:[(P=t==null?void 0:t.materia)==null?void 0:P.totalEstudiantes," "]}),e.jsx(n.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:e.jsx(_,{})})]})]}),e.jsxs(c,{children:[e.jsx(n.Title,{style:{color:"white"},level:3,children:"Estudiantes reprobados"}),e.jsxs(l,{justify:"space-between",children:[e.jsxs(n.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:[(D=t==null?void 0:t.materia)==null?void 0:D.cantidad," "]}),e.jsx(n.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:e.jsx(_,{})})]})]})]})}),(I=t==null?void 0:t.data)==null?void 0:I.map((a,o)=>e.jsxs(m.Grid,{style:{width:"50%",backgroundColor:"white",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(n.Link,{children:a.grupo}),e.jsx(y,{title:"Cantidad de estudiantes",value:a==null?void 0:a.cantidadTotal}),e.jsx(y,{title:"Reprobados por asistencia",value:parseFloat((a==null?void 0:a.cantidadAsistencia)/(a==null?void 0:a.cantidadTotal)*100).toFixed(2)+"%"}),e.jsx(y,{title:"Reprobados por nota",value:parseFloat((a==null?void 0:a.cantidadNota)/(a==null?void 0:a.cantidadTotal)*100).toFixed(2)+"%"}),e.jsx(n.Link,{children:a==null?void 0:a.docente})]}))]}):e.jsx(A,{})}),Object.keys(t).length>0?e.jsx(c,{xs:24,sm:24,md:24,lg:11,xl:11,children:e.jsx(se,{data:Q,isGroup:!0,xField:"grupo",yField:"value",seriesField:"name",colorField:"name"})}):e.jsx(A,{})]})}),e.jsx(oe,{columns:M,dataSource:V,style:{width:"100%"}})]})]})]})};export{we as default};
