import{r as i,A as L,_ as D,R as M,b as N,j as e,B as G,c as H,d as J,e as K}from"./index-aff8c025.js";import{F as Q,S as O,E as X,h as Y}from"./html2canvas.esm-353716dd.js";import{U as _}from"./UtilService-9f1161d4.js";import{F as x,C}from"./index-aa3aee1a.js";import{P as Z}from"./index-383340ee.js";import{B as tt}from"./index-bed80768.js";import{L as et}from"./index-b7824dac.js";import{B as at}from"./index-0be3d287.js";import{R as p}from"./row-0e000846.js";import{C as j,S as B,E as st}from"./index-54e651da.js";import{A as ot}from"./index-2df60e21.js";import"./useForceUpdate-a70ac771.js";var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};const rt=it;var nt=function(r,n){return i.createElement(L,D({},r,{ref:n,icon:rt}))},dt=i.forwardRef(nt);const lt=dt;var ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};const ut=ct;var ht=function(r,n){return i.createElement(L,D({},r,{ref:n,icon:ut}))},ft=i.forwardRef(ht);const mt=ft;var P=globalThis&&globalThis.__assign||function(){return P=Object.assign||function(d){for(var r,n=1,w=arguments.length;n<w;n++){r=arguments[n];for(var m in r)Object.prototype.hasOwnProperty.call(r,m)&&(d[m]=r[m])}return d},P.apply(this,arguments)},gt=i.forwardRef(function(d,r){return M.createElement(at,P({},d,{chartType:"Liquid",ref:r}))});const pt=gt,At=()=>{var A;const[d,r]=i.useState([]),[n,w]=i.useState([]),[m,I]=i.useState(!0),[b,T]=i.useState(0),[F,U]=i.useState({}),[s,$]=i.useState([]),[S]=x.useForm(),v=N(),y=i.useRef([]),k=t=>{y.current.push(t)},z=()=>{const t=new X;let a=[];y.current.forEach((l,c)=>{a.push(Y(l).then(o=>{const u=o.toDataURL("image/png"),h=t.internal.pageSize.getWidth(),f=o.height*h/o.width;c>0&&t.addPage(),t.addImage(u,"PNG",0,0,h,f)}))}),Promise.all(a).then(()=>{t.save("download.pdf")})},V=t=>{_.obtenerComboPeriodo({id_carrera:t}).then(a=>{var l,c;if(a.data.ok)if(a.data.data.configuracion===null)I(!1);else{const o=(c=(l=a==null?void 0:a.data)==null?void 0:l.data)==null?void 0:c.periodo.map((u,h)=>{var f,R;return{value:u.value,label:u.label,disabled:((R=(f=a==null?void 0:a.data)==null?void 0:f.data)==null?void 0:R.periodo.length)-a.data.data.configuracion.periodos_desercion<h}});r(o)}})},W=()=>{_.getComboCarreras().then(t=>{t.data.ok&&w(t.data.data)})},q=t=>{v(H());const a=S.getFieldsValue(),l=n.filter(o=>o.value===a.carrera)[0],c=d.filter(o=>o.value===a.periodo)[0];U({carrera:l,periodo:c}),_.obtenerDataPeriodo(a).then(o=>{T(o.data.total);const u=o.data.data.sort((h,f)=>f.row-h.row);$(u)}).catch(o=>{v(J({success:!1,title:"Error al obtener datos",message:o.response.data.message}))}).finally(()=>v(K()))};i.useEffect(()=>{W()},[]);const g=s.map(t=>({codigo:t==null?void 0:t.codigo,cantidad_estudiantes:t==null?void 0:t.total_estudiantes})),E=[{id:1,graphic:e.jsx(et,{data:g,xField:"codigo",yField:"cantidad_estudiantes",width:450,height:350,point:{shapeField:"square",sizeField:4},interaction:{tooltip:{marker:!1}},style:{lineWidth:2}})},{id:2,graphic:e.jsx(tt,{data:g,xField:"codigo",yField:"cantidad_estudiantes",width:450,paddingRight:80,style:{maxWidth:25},markBackground:{label:{text:({originData:t})=>{var a;return`${((t==null?void 0:t.cantidad_estudiantes)/((a=g[0])==null?void 0:a.cantidad_estudiantes)*100).toFixed(2)}% | ${t==null?void 0:t.cantidad_estudiantes}`},position:"right",dx:80}},scale:{y:{domain:[0,(A=g[0])==null?void 0:A.cantidad_estudiantes]}},interaction:{elementHighlightByColor:!1}})},{id:3,graphic:e.jsx(Z,{data:g,colorField:"codigo",width:450,height:350,angleField:"cantidad_estudiantes",label:{text:"codigo",style:{fontWeight:"bold"}},legend:{color:{title:!1,position:"right",rowPadding:5}}})}];return e.jsxs("div",{children:[e.jsx("h2",{children:"Indicador Tasa de Desercion"}),e.jsx(p,{children:e.jsxs(j,{style:{width:"100%"},children:[e.jsxs(x,{form:S,layout:"vertical",children:[!m&&e.jsx(ot,{message:"No existen datos de configuracion",description:"Asigne los datos de configuracion para esta carrera antes de continuar",type:"warning",showIcon:!0}),e.jsxs(p,{justify:"space-around",children:[e.jsx(C,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(x.Item,{label:"Carrera",name:"carrera",children:e.jsx(B,{placeholder:"Seleccione una carrera",options:n,onChange:t=>{V(t)}})})}),e.jsx(C,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(x.Item,{label:"Periodo",name:"periodo",children:e.jsx(B,{placeholder:"Seleccione un periodo",options:d,onChange:t=>{q()}})})})]})]}),s.length>0&&e.jsx(p,{justify:"end",children:e.jsx(G,{disabled:!s.length>0,icon:e.jsx(Q,{}),className:"botonPdf",onClick:z,type:"primary",children:"Descargar PDF"})})]})}),s.length>0?e.jsxs(j,{ref:k,title:e.jsxs(e.Fragment,{children:[F.carrera.label," ",e.jsx("span",{style:{marginInline:"15px"}})," ",F.periodo.label]}),children:[e.jsx(p,{justify:"space-around",children:s.map((t,a)=>e.jsx(C,{xs:12,sm:12,md:12,lg:10,xl:4,children:e.jsxs(j,{title:t.codigo,style:{borderRadius:12,boxShadow:"0 4px 8px rgba(0,0,0,0.1)",margin:"10px",textAlign:"center"},headStyle:{fontSize:"1.3em",color:"#BBB",textAlign:"center"},children:[e.jsx(pt,{height:150,percent:parseFloat((t.total_estudiantes/b).toFixed(4))}),e.jsx(O,{title:s[a-1]?s[a-1].total_estudiantes<t.total_estudiantes?"Matriculados":"Desertados":"-",value:s[a-1]?s[a-1].total_estudiantes<t.total_estudiantes?t.total_estudiantes-s[a-1].total_estudiantes:s[a-1].total_estudiantes-t.total_estudiantes:0,valueStyle:{color:s[a-1]?s[a-1].total_estudiantes<t.total_estudiantes?"#3f8600":"#cf1322":""},prefix:s[a-1]?s[a-1].total_estudiantes<t.total_estudiantes?e.jsx(mt,{}):e.jsx(lt,{}):"",suffix:s[a-1]?s[a-1].total_estudiantes<t.total_estudiantes?"+":"-":""}),e.jsx(O,{title:"Tasa deserciÃ³n",value:parseFloat(((b-t.total_estudiantes)/b*100).toFixed(2)),suffix:"%"})]})},a))}),e.jsxs(p,{justify:"space-evenly",children:[E[2].graphic,E[0].graphic]})]}):e.jsx(j,{style:{justifyContent:"center",display:"flex",height:"60vh",alignItems:"center"},children:e.jsx(st,{})})]})};export{At as default};
