import{r as l,R as ie,j as t,b as re,B as se,c as V,d as U,e as q}from"./index-aff8c025.js";import{U as F}from"./UtilService-9f1161d4.js";import{B as ne}from"./index-0be3d287.js";import{F as oe,S as C}from"./html2canvas.esm-353716dd.js";import{h as le}from"./html2pdf-e312280b.js";import{F as j,C as m}from"./index-aa3aee1a.js";import{A as ce}from"./index-2df60e21.js";import{R as h}from"./row-0e000846.js";import{S as w,C as r,E as f}from"./index-54e651da.js";import{T as de}from"./Table-29551d85.js";import{B as me}from"./index-bed80768.js";import{L as ue}from"./index-b7824dac.js";import"./useForceUpdate-a70ac771.js";import"./styleChecker-5146645c.js";import"./scrollTo-e0f35868.js";import"./BaseInput-08586a27.js";import"./index-3468cdee.js";import"./TextArea-97b9cd34.js";import"./EyeOutlined-9f393984.js";var S=globalThis&&globalThis.__assign||function(){return S=Object.assign||function(s){for(var e,c=1,u=arguments.length;c<u;c++){e=arguments[c];for(var g in e)Object.prototype.hasOwnProperty.call(e,g)&&(s[g]=e[g])}return s},S.apply(this,arguments)},xe=l.forwardRef(function(s,e){return ie.createElement(ne,S({},s,{chartType:"Gauge",ref:e}))});const ge=xe,z=s=>{const e={width:400,height:400,data:{target:s.target,total:s.total},style:{textContent:(c,u)=>`${parseFloat(c/u*100).toFixed(2)}%`}};return t.jsx(ge,{...e})},Ie=()=>{var G,R,k,A,I,B,N,O;const s=re(),[e,c]=l.useState({}),[u,g]=l.useState([]),[T,$]=l.useState([]),[D,E]=l.useState({carrera:"",periodo:""}),[H,J]=l.useState(!0),[d,K]=l.useState({}),[p]=j.useForm(),P=l.useRef([]),Q=()=>{const a=P.current,n={filename:"Dashboard "+d.carrera.label+" _ "+d.periodo.label+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,dpi:192,letterRendering:!0},jsPDF:{unit:"in",format:[14,13],orientation:"portrait"}};le().from(a).set(n).save()},W=(a,n)=>{E({...D,carrera:n.label}),F.obtenerComboPeriodo({id_carrera:a}).then(i=>{var v,b;if(i.data.ok)if(i.data.data.configuracion===null)J(!1);else{const o=(b=(v=i==null?void 0:i.data)==null?void 0:v.data)==null?void 0:b.periodo.map((_,ae)=>{var L,M;return{value:_.value,label:_.label,disabled:((M=(L=i==null?void 0:i.data)==null?void 0:L.data)==null?void 0:M.periodo.length)-i.data.data.configuracion.periodos_desercion<ae}});g(o)}})},y=(G=e==null?void 0:e.reprobados)==null?void 0:G.map((a,n)=>({numero:(e==null?void 0:e.reprobados.length)-n,materia:a.materia,cantidad:a.cantidad,cantidadAsistencia:a.cantidadAsistencia,cantidadNota:a.cantidadNota})),X=y==null?void 0:y.map(a=>[{materia:a.materia,name:"Reprobados por nota",value:a.cantidadNota},{materia:a.materia,name:"Reprobados por asistencia",value:a.cantidadAsistencia}]).flat(),Y=[{align:"right",key:"numero",dataIndex:"numero",title:"Top"},{align:"right",key:"materia",dataIndex:"materia",title:"Materia",width:240},{align:"right",key:"cantidadAsistencia",dataIndex:"cantidadAsistencia",title:"Por asistencia"},{align:"right",key:"cantidadNota",dataIndex:"cantidadNota",title:"Por promedio"},{align:"right",key:"cantidad",dataIndex:"cantidad",title:"Total"}],Z=()=>{F.getComboCarreras().then(a=>{a.data.ok&&$(a.data.data)})},ee=(a,n)=>{p.resetFields(["nivel"]),E({...D,periodo:n.label});const i=p.getFieldsValue(),v=T.filter(o=>o.value===i.carrera)[0],b=u.filter(o=>o.value===i.periodo)[0];K({carrera:v,periodo:b}),s(V()),F.obtenerDashboard(i).then(o=>{o.data.ok&&c(o.data.data)}).catch(o=>{s(U({success:!1,title:"Error al obtener datos del dashboard",message:o.response.data.error}))}).finally(()=>s(q()))};l.useEffect(()=>{Z()},[]),l.useEffect(()=>{const a=setTimeout(()=>{if("nivel"in e){p.setFieldsValue({nivel:e.nivel});const{nivel:n,...i}=e;c(i)}},500);return()=>clearTimeout(a)},[e]);const te=a=>{s(V());let n=p.getFieldsValue();n.nivel=a,F.obtenerDashboardLogros(n).then(i=>{i.data.ok&&c({...e,logros:i.data.data.data})}).catch(i=>{s(U({success:!1,title:"Error al obtener datos del dashboard",message:i.response.data.error}))}).finally(()=>s(q()))},x={width:"50%",textAlign:"center"};return t.jsxs("div",{children:[t.jsx("h1",{children:"Dashboard"}),t.jsxs(j,{form:p,children:[!H&&t.jsx(ce,{message:"No existen datos de configuracion",description:"Asigne los datos de configuracion para esta carrera antes de continuar",type:"warning",showIcon:!0}),t.jsxs(h,{style:{marginTop:"20px"},children:[t.jsx(m,{children:t.jsx(j.Item,{label:"Carrera",name:"carrera",children:t.jsx(w,{placeholder:"Seleccione una carrera",options:T,onChange:W})})}),t.jsx(m,{children:t.jsx(j.Item,{label:"Periodo",name:"periodo",children:t.jsx(w,{placeholder:"Seleccione un periodo",options:u,onChange:ee})})})]}),t.jsxs(r,{ref:P,title:t.jsxs(h,{justify:"space-between",children:[t.jsxs(m,{children:[(R=d==null?void 0:d.carrera)==null?void 0:R.label," ",t.jsx("span",{style:{marginInline:"15px"}})," ",(k=d==null?void 0:d.periodo)==null?void 0:k.label]}),t.jsx(m,{children:Object.keys(e).length>0&&t.jsx(se,{icon:t.jsx(oe,{}),type:"primary",onClick:Q,className:"botonPdf",children:"Descargar PDF"})})]}),children:[t.jsxs(r,{children:[t.jsx(r.Grid,{style:x,children:e!=null&&e.desercion?t.jsxs(t.Fragment,{children:[t.jsxs(r,{title:"Tasa de deserci贸n",children:[t.jsx(r.Grid,{style:x,children:t.jsx(C,{title:"Estudiantes Base",value:e.desercion.nivelacion})}),t.jsx(r.Grid,{style:x,children:t.jsx(C,{title:"Estudiantes actuales",value:e.desercion.actual})})]}),t.jsx(z,{target:((A=e==null?void 0:e.desercion)==null?void 0:A.nivelacion)-((I=e==null?void 0:e.desercion)==null?void 0:I.actual),total:(B=e==null?void 0:e.desercion)==null?void 0:B.nivelacion})]}):t.jsx(r,{title:"Tasa de deserci贸n",children:t.jsx(f,{style:{width:"100%",padding:"30px"}})})}),t.jsx(r.Grid,{style:x,children:e!=null&&e.titulacion?t.jsxs(t.Fragment,{children:[t.jsxs(r,{title:"Tasa de titulaci贸n",children:[t.jsx(r.Grid,{style:x,children:t.jsx(C,{title:"Estudiantes Base",value:e.titulacion.nivelacion})}),t.jsx(r.Grid,{style:x,children:t.jsx(C,{title:"Estudiantes Titulados",value:e.titulacion.titulados})})]}),t.jsx(z,{target:(N=e==null?void 0:e.titulacion)==null?void 0:N.titulados,total:(O=e==null?void 0:e.titulacion)==null?void 0:O.nivelacion})]}):t.jsx(r,{title:"Tasa de titulaci贸n",children:t.jsx(f,{style:{width:"100%",padding:"30px"}})})})]}),t.jsx(r,{style:{textAlign:"center",marginTop:"20px"},title:"Top materias con mayor cantidad de reprobados",children:e!=null&&e.reprobados&&(e==null?void 0:e.reprobados.length)>0?t.jsxs(h,{justify:"space-evenly",children:[t.jsx(m,{xs:24,sm:24,md:24,lg:12,xl:12,children:t.jsx(de,{bordered:!1,dataSource:y,pagination:!1,columns:Y,scroll:{x:600,y:400}})}),t.jsx(m,{xs:24,sm:24,md:24,lg:12,xl:12,children:t.jsx(me,{data:X,isGroup:!0,xField:"materia",yField:"value",seriesField:"name",colorField:"name"})})]}):t.jsxs(h,{justify:"space-evenly",children:[t.jsx(m,{xs:24,sm:24,md:24,lg:12,xl:12,children:t.jsx(f,{})}),t.jsx(m,{xs:24,sm:24,md:24,lg:12,xl:12,children:t.jsx(f,{})})]})}),t.jsx(r,{style:{textAlign:"center",marginTop:"20px"},title:t.jsxs(t.Fragment,{children:["Logros de aprendizaje por materia",t.jsx(h,{justify:"end",children:t.jsx(j.Item,{name:"nivel",style:{width:"100px"},children:t.jsx(w,{options:e==null?void 0:e.niveles,onChange:te})})})]}),children:e!=null&&e.logros&&(e==null?void 0:e.logros.length)>0?e==null?void 0:e.logros.map((a,n)=>t.jsx(r.Grid,{style:{width:"50%"},children:t.jsx(ue,{style:{width:"100%"},data:a.data,xField:"logro",yField:"promedio",seriesField:"docente",title:a.materia,colorField:"docente"})})):t.jsx(f,{})})]})]})]})};export{Ie as default};
