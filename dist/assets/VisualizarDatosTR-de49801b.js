import{r as i,b as ee,j as e,B as G,c as f,d as g,e as y}from"./index-aff8c025.js";import{F as ae,S as u}from"./html2canvas.esm-353716dd.js";import{h as te}from"./html2pdf-e312280b.js";import{U as h}from"./UtilService-9f1161d4.js";import{E as oe}from"./ExcelService-e5139f15.js";import{F as m,C as x}from"./index-aa3aee1a.js";import{R as p}from"./row-0e000846.js";import{C as n,S as C,E as V}from"./index-54e651da.js";import{T as l}from"./index-ed149759.js";import{C as re}from"./index-fd520192.js";import{T as se}from"./Table-29551d85.js";import{F as ie}from"./FileExcelOutlined-350b7852.js";import{T as ne}from"./TeamOutlined-8b32d5ec.js";import"./useForceUpdate-a70ac771.js";import"./EditOutlined-232863e3.js";import"./styleChecker-5146645c.js";import"./TextArea-97b9cd34.js";import"./BaseInput-08586a27.js";import"./index-0be3d287.js";import"./scrollTo-e0f35868.js";import"./index-3468cdee.js";import"./EyeOutlined-9f393984.js";const De=()=>{var E,S,k,w,D,P,O,I,A,_,N;const[R,B]=i.useState([]),[F,L]=i.useState([]),[U,z]=i.useState([]),[a,v]=i.useState({}),[W,$]=i.useState([]),[d,q]=i.useState({}),[c]=m.useForm(),s=ee(),T=i.useRef(),H=()=>{const t=T.current,o={filename:"Tasa_Reprobados "+d.carrera.label+" _ "+d.periodo.label+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,dpi:192,letterRendering:!0},jsPDF:{unit:"in",format:[13,9],orientation:"landscape"}};te().from(t).set(o).save()},J=t=>{h.obtenerComboPeriodoReprobados({id_carrera:t}).then(o=>{o.data.ok&&B(o.data.data)})},K=()=>{h.getComboCarreras().then(t=>{t.data.ok&&L(t.data.data)})},Q=t=>{s(f());const o=c.getFieldsValue(),b=F.filter(r=>r.value===o.carrera)[0],j=R.filter(r=>r.value===o.periodo)[0];q({carrera:b,periodo:j}),h.obtenerReprobadosMateria(o).then(r=>{r.data.ok&&(z(r.data.data),v(r.data.mas_reprobado),$(r.data.materias),c.setFieldsValue({materia:r.data.mas_reprobado.materia.id_materia}))}).catch(r=>{s(g({success:!1,title:"Error al obtener datos",message:r.response.data.error}))}).finally(()=>s(y()))};i.useEffect(()=>{K()},[]);const X=()=>{s(f());const t=c.getFieldsValue();h.obtenerReprobadoMateriaDetalle(t).then(o=>{o.data.ok&&v(o.data.data)}).catch(o=>{s(g({success:!1,title:"Error al obtener datos",message:o.response.data.error}))}).finally(()=>s(y()))},Y=()=>{s(f());const t=c.getFieldsValue();oe.descargarExcelTasaReprobados(t).then(async o=>{const b=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),j=window.URL.createObjectURL(b),r=document.createElement("a");r.href=j,r.download=`REPORTE_TASA_REPROBADOS_${d.carrera.label} _ ${d.periodo.label}.xlsx`,document.body.appendChild(r),r.click(),r.remove()}).catch(o=>{s(g({success:!1,title:"Error al descargar el reporte",message:o.response.data.error}))}).finally(()=>s(y()))},Z=[{align:"left",key:"materia",dataIndex:"materia",title:"Materia"},{align:"right",key:"cantidad",dataIndex:"cantidad",title:"Total Reprobados"},{align:"right",key:"cantidadAsistencia",dataIndex:"cantidadAsistencia",title:"Reprobados por asistencia"},{align:"center",key:"cantidadNota",dataIndex:"cantidadNota",title:"Reprobados por promedio"}],M=(E=a==null?void 0:a.data)==null?void 0:E.map(t=>[{grupo:t==null?void 0:t.grupo,name:"Reprobados por nota",value:t.cantidadNota},{grupo:t==null?void 0:t.grupo,name:"Reprobados por asistencia",value:t.cantidadAsistencia}]).flat();return e.jsxs("div",{children:[e.jsx("h2",{children:"Indicador Tasa de Reprobados"}),e.jsxs(m,{form:c,layout:"vertical",children:[e.jsx(p,{children:e.jsxs(n,{style:{width:"100%"},children:[e.jsxs(p,{justify:"space-around",children:[e.jsx(x,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(m.Item,{label:"Carrera",name:"carrera",children:e.jsx(C,{placeholder:"Seleccione una carrera",options:F,onChange:t=>{J(t)}})})}),e.jsx(x,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(m.Item,{label:"Periodo",name:"periodo",children:e.jsx(C,{placeholder:"Seleccione un periodo",options:R,onChange:t=>{Q()}})})})]}),Object.keys(a).length>0&&e.jsxs(p,{justify:"end",children:[e.jsx(G,{icon:e.jsx(ie,{}),type:"primary",onClick:Y,className:"botonExcel",children:"Descargar reporte"}),e.jsx(G,{icon:e.jsx(ae,{}),type:"primary",onClick:H,className:"botonPdf",children:"Descargar PDF"})]})]})}),e.jsxs(n,{title:"Reprobados",children:[Object.keys(a).length>0&&e.jsx(m.Item,{name:"materia",label:"Materia",children:e.jsx(C,{style:{width:"300px"},placeholder:"Seleccione una materia",options:W,onChange:X})}),e.jsx(n,{ref:T,bordered:!1,title:e.jsxs(e.Fragment,{children:[(S=d.carrera)==null?void 0:S.label," ",e.jsx("span",{style:{marginInline:"15px"}})," ",(k=d.periodo)==null?void 0:k.label,"  ",e.jsx("span",{style:{marginInline:"15px"}})," ",(w=a==null?void 0:a.materia)==null?void 0:w.materia]}),children:e.jsxs(p,{justify:"space-between",children:[e.jsx(x,{xs:24,sm:24,md:24,lg:11,xl:11,children:Object.keys(a).length>0?e.jsxs(n,{children:[e.jsxs(n.Grid,{style:{width:"100%",backgroundColor:"#0161DA"},children:[e.jsx(l.Title,{style:{color:"white"},level:3,children:"Total de estudiantes reprobados"}),e.jsxs(p,{justify:"space-between",children:[e.jsxs(l.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:[(D=a==null?void 0:a.materia)==null?void 0:D.cantidad," "]}),e.jsx(l.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:e.jsx(ne,{})})]})]}),e.jsxs(n.Grid,{style:{width:"50%",backgroundColor:"white",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(l.Link,{children:"Reprobados por nota"}),e.jsx(u,{title:"Cantidad de estudiantes",value:(P=a==null?void 0:a.materia)==null?void 0:P.cantidadNota}),e.jsx(u,{title:"Porcentaje de reprobados",value:parseFloat(((O=a==null?void 0:a.materia)==null?void 0:O.cantidadNota)/((I=a==null?void 0:a.materia)==null?void 0:I.cantidad)*100).toFixed(2)+"%"}),e.jsx(l.Text,{italic:!0,type:"secondary",children:"El porcentaje es en referencia al total de reprobados"})]}),e.jsxs(n.Grid,{style:{width:"50%",backgroundColor:"white",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(l.Link,{children:"Reprobados por asistencia"}),e.jsx(u,{title:"Cantidad de estudiantes",value:(A=a==null?void 0:a.materia)==null?void 0:A.cantidadAsistencia}),e.jsx(u,{title:"Porcentaje de reprobados",value:parseFloat(((_=a==null?void 0:a.materia)==null?void 0:_.cantidadAsistencia)/((N=a==null?void 0:a.materia)==null?void 0:N.cantidad)*100).toFixed(2)+"%"}),e.jsx(l.Text,{italic:!0,type:"secondary",children:"El porcentaje es en referencia al total de reprobados"})]})]}):e.jsx(V,{})}),Object.keys(a).length>0?e.jsx(x,{xs:24,sm:24,md:24,lg:11,xl:11,children:e.jsx(re,{data:M,isGroup:!0,xField:"grupo",yField:"value",seriesField:"name",colorField:"name"})}):e.jsx(V,{})]})}),e.jsx(se,{columns:Z,dataSource:U,style:{width:"100%"}})]})]})]})};export{De as default};
