import{r,b as q,j as e,B as P,c as v,d as E,e as S}from"./index-15240922.js";import{F as H,S as _}from"./html2canvas.esm-a5085a31.js";import{h as J}from"./html2pdf-19a8da04.js";import{U as f}from"./UtilService-4db337ed.js";import{E as K}from"./ExcelService-2ca9fc3b.js";import{F as m,C as n}from"./index-5590f4ee.js";import{R as d}from"./row-5d227883.js";import{C as i,S as w,E as F}from"./index-6ab464cc.js";import{A as Q}from"./index-e68c2b59.js";import{F as X}from"./FileExcelOutlined-1d83c243.js";import{T as u}from"./index-ec864326.js";import{T as Y}from"./TeamOutlined-67d7b0f1.js";import{T as k}from"./Table-b4bf00f1.js";import{P as Z}from"./index-2161078a.js";import"./useForceUpdate-d8c4c42e.js";import"./EditOutlined-ea388460.js";import"./styleChecker-bc4901ce.js";import"./TextArea-a7b7f909.js";import"./BaseInput-d53a2d9c.js";import"./scrollTo-528c30a2.js";import"./index-be7a82b5.js";import"./EyeOutlined-f74af4a3.js";import"./index-d45f498e.js";const Pe=()=>{const[g,D]=r.useState([]),[j,I]=r.useState([]),[R,A]=r.useState(!0),[b,O]=r.useState([]),[G,U]=r.useState([]),[s,L]=r.useState({}),[c,N]=r.useState([]),[y,z]=r.useState([]),[x]=m.useForm(),l=q(),T=r.useRef([]),B=()=>{const a=T.current,o={filename:"Tasa_Titulacion "+s.carrera.label+" _ "+s.periodo.label+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,dpi:192,letterRendering:!0},jsPDF:{unit:"in",format:[13,9],orientation:"landscape"}};J().from(a).set(o).save()},V=()=>{l(v());const a=x.getFieldsValue();K.descargarExcelTasaTitulacion(a).then(async o=>{const p=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(p),t=document.createElement("a");t.href=h,t.download=`REPORTE_TASA_TITULACION_${s.carrera.label} _ ${s.periodo.label}.xlsx`,document.body.appendChild(t),t.click(),t.remove()}).catch(o=>{l(E({success:!1,title:"Error al descargar el reporte",message:o.response.data.error}))}).finally(()=>l(S()))},M=a=>{f.obtenerComboPeriodoTitulacion({id_carrera:a}).then(o=>{o.data.ok&&(o.data.data.configuracion===null?A(!1):D(o.data.data.periodo))})},W=()=>{f.getComboCarreras().then(a=>{a.data.ok&&I(a.data.data)})},$=a=>{l(v());const o=x.getFieldsValue(),p=j.filter(t=>t.value===o.carrera)[0],h=g.filter(t=>t.value===o.periodo)[0];L({carrera:p,periodo:h}),f.obtenerDataPeriodoTitulacion(o).then(t=>{t.data.ok&&(O(t.data.data),U(t.data.data_table),z(t.data.data.titulados_nivelacion),N(t.data.data.titulados_nivelacion))}).catch(t=>{l(E({success:!1,title:"Error al obtener datos",message:t.response.data.error}))}).finally(()=>l(S()))};console.log(y),r.useEffect(()=>{W()},[]);const C=[{align:"left",key:"estudiante",dataIndex:"estudiante",title:"Estudiante"},{align:"right",key:"periodo_titulacion",dataIndex:"periodo_titulacion",title:"Periodo Titulaci贸n"},{align:"right",key:"eperiodo_ingresostudiante",dataIndex:"periodo_ingreso",title:"Periodo Ingreso"},{align:"center",key:"prom_materia",dataIndex:"prom_materia",title:"Prom. Materia"},{align:"center",key:"prom_titulacion",dataIndex:"prom_titulacion",title:"Prom. Titulaci贸n"},{align:"center",key:"prom_general",dataIndex:"prom_general",title:"Prom. General"}];return e.jsxs("div",{children:[e.jsx("h2",{children:"Indicador Tasa de Titulaci贸n"}),e.jsx(d,{children:e.jsxs(i,{style:{width:"100%"},children:[e.jsxs(m,{form:x,layout:"vertical",children:[!R&&e.jsx(Q,{message:"No existen datos de configuracion",description:"Asigne los datos de configuracion para esta carrera antes de continuar",type:"warning",showIcon:!0}),e.jsxs(d,{justify:"space-around",children:[e.jsx(n,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(m.Item,{label:"Carrera",name:"carrera",children:e.jsx(w,{placeholder:"Seleccione una carrera",options:j,onChange:a=>{M(a)}})})}),e.jsx(n,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(m.Item,{label:"Periodo",name:"periodo",children:e.jsx(w,{placeholder:"Seleccione un periodo",options:g,onChange:a=>{$()}})})})]})]}),c.length>0&&e.jsxs(d,{justify:"end",children:[e.jsx(P,{disabled:!c.length>0,icon:e.jsx(X,{}),type:"primary",onClick:V,className:"botonExcel",children:"Descargar reporte"}),e.jsx(P,{disabled:!c.length>0,icon:e.jsx(H,{}),type:"primary",onClick:B,className:"botonPdf",children:"Descargar PDF"})]})]})}),c.length>0?e.jsxs(i,{title:"Tasa de titulaci贸n",children:[e.jsx(i,{ref:T,title:e.jsxs(e.Fragment,{children:[s.carrera.label," ",e.jsx("span",{style:{marginInline:"15px"}})," ",s.periodo.label]}),children:e.jsxs(d,{justify:"space-between",children:[e.jsx(n,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsxs(i,{children:[e.jsxs(i.Grid,{style:{width:"100%",backgroundColor:"#0161DA"},children:[e.jsx(u.Title,{style:{color:"white"},level:3,children:"Total de estudiantes titulados"}),e.jsxs(d,{justify:"space-between",children:[e.jsxs(u.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:[b.total_titulados.value," "]}),e.jsx(u.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:e.jsx(Y,{})})]})]}),c.map((a,o)=>e.jsxs(i.Grid,{style:{width:"50%",backgroundColor:"white",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(u.Link,{children:a.label}),e.jsx(_,{title:"Cantidad de estudiantes",value:a.value}),e.jsx(_,{title:"Porcentaje de titulacion",value:parseFloat(a.value/b.total_titulados.value*100).toFixed(2)+"%"})]}))]})}),e.jsx(n,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(Z,{data:y,angleField:"value",colorField:"label"})})]})}),e.jsx(k,{dataSource:G,columns:C,style:{width:"100%",marginTop:"30px"}})]}):e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(n,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(F,{})}),e.jsx(n,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(F,{})})]}),e.jsx(k,{columns:C,style:{width:"100%",marginTop:"30px"}})]})]})};export{Pe as default};
