import{r as i,b as X,j as e,B as C,c as P,d as _,e as S}from"./index-aff8c025.js";import{F as Y,S as E}from"./html2canvas.esm-353716dd.js";import{h as Z}from"./html2pdf-e312280b.js";import{U as f}from"./UtilService-9f1161d4.js";import{E as ee}from"./ExcelService-e5139f15.js";import{F as x,C as c}from"./index-aa3aee1a.js";import{R as m}from"./row-0e000846.js";import{C as r,S as w,E as F}from"./index-54e651da.js";import{A as ae}from"./index-2df60e21.js";import{F as te}from"./FileExcelOutlined-350b7852.js";import{T as p}from"./index-ed149759.js";import{T as oe}from"./TeamOutlined-8b32d5ec.js";import{T as k}from"./Table-29551d85.js";import{P as ie}from"./index-383340ee.js";import"./useForceUpdate-a70ac771.js";import"./EditOutlined-232863e3.js";import"./styleChecker-5146645c.js";import"./TextArea-97b9cd34.js";import"./BaseInput-08586a27.js";import"./scrollTo-e0f35868.js";import"./index-3468cdee.js";import"./EyeOutlined-9f393984.js";import"./index-0be3d287.js";const Fe=()=>{const[g,D]=i.useState([]),[j,I]=i.useState([]),[re,R]=i.useState([]);i.useState(0);const[O,A]=i.useState(!0),[b,G]=i.useState([]),[U,L]=i.useState([]),[l,N]=i.useState({}),[u,z]=i.useState([]),[B,V]=i.useState([]),[h]=x.useForm(),s=X(),y=i.useRef([]),M=()=>{const o=y.current,t={filename:"Tasa_Titulacion "+l.carrera.label+" _ "+l.periodo.label+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,dpi:192,letterRendering:!0},jsPDF:{unit:"in",format:[13,9],orientation:"landscape"}};Z().from(o).set(t).save()},W=()=>{s(P());const o=h.getFieldsValue();ee.descargarExcelTasaTitulacion(o).then(async t=>{const n=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(n),a=document.createElement("a");a.href=d,a.download=`REPORTE_TASA_TITULACION_${l.carrera.label} _ ${l.periodo.label}.xlsx`,document.body.appendChild(a),a.click(),a.remove()}).catch(t=>{s(_({success:!1,title:"Error al descargar el reporte",message:t.response.data.error}))}).finally(()=>s(S()))},$=o=>{f.obtenerComboPeriodoTitulacion({id_carrera:o}).then(t=>{var n,d;t.data.ok&&(t.data.data.configuracion===null?A(!1):(D(t.data.data.periodo),R((d=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:d.tipo_grafico)))})},q=()=>{f.getComboCarreras().then(o=>{o.data.ok&&I(o.data.data)})},H=o=>{s(P());const t=h.getFieldsValue(),n=j.filter(a=>a.value===t.carrera)[0],d=g.filter(a=>a.value===t.periodo)[0];N({carrera:n,periodo:d}),f.obtenerDataPeriodoTitulacion(t).then(a=>{var v;if(a.data.ok){G(a.data.data),L(a.data.data_table);const J=((v=a.data.data.total_titulados)==null?void 0:v.value)-a.data.data.titulados_nivelacion.reduce((K,Q)=>({value:K.value+Q.value})).value;V([...a.data.data.titulados_nivelacion,{value:J,label:"otros"}]),z(a.data.data.titulados_nivelacion)}}).catch(a=>{s(_({success:!1,title:"Error al obtener datos",message:a.response.data.error}))}).finally(()=>s(S()))};i.useEffect(()=>{q()},[]);const T=[{align:"left",key:"estudiante",dataIndex:"estudiante",title:"Estudiante"},{align:"right",key:"periodo_titulacion",dataIndex:"periodo_titulacion",title:"Periodo Titulaci贸n"},{align:"right",key:"eperiodo_ingresostudiante",dataIndex:"periodo_ingreso",title:"Periodo Ingreso"},{align:"center",key:"prom_materia",dataIndex:"prom_materia",title:"Prom. Materia"},{align:"center",key:"prom_titulacion",dataIndex:"prom_titulacion",title:"Prom. Titulaci贸n"},{align:"center",key:"prom_general",dataIndex:"prom_general",title:"Prom. General"}];return e.jsxs("div",{children:[e.jsx("h2",{children:"Indicador Tasa de Titulaci贸n"}),e.jsx(m,{children:e.jsxs(r,{style:{width:"100%"},children:[e.jsxs(x,{form:h,layout:"vertical",children:[!O&&e.jsx(ae,{message:"No existen datos de configuracion",description:"Asigne los datos de configuracion para esta carrera antes de continuar",type:"warning",showIcon:!0}),e.jsxs(m,{justify:"space-around",children:[e.jsx(c,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(x.Item,{label:"Carrera",name:"carrera",children:e.jsx(w,{placeholder:"Seleccione una carrera",options:j,onChange:o=>{$(o)}})})}),e.jsx(c,{xs:24,sm:24,md:7,lg:7,xl:8,children:e.jsx(x.Item,{label:"Periodo",name:"periodo",children:e.jsx(w,{placeholder:"Seleccione un periodo",options:g,onChange:o=>{H()}})})})]})]}),u.length>0&&e.jsxs(m,{justify:"end",children:[e.jsx(C,{disabled:!u.length>0,icon:e.jsx(te,{}),type:"primary",onClick:W,className:"botonExcel",children:"Descargar reporte"}),e.jsx(C,{disabled:!u.length>0,icon:e.jsx(Y,{}),type:"primary",onClick:M,className:"botonPdf",children:"Descargar PDF"})]})]})}),u.length>0?e.jsxs(r,{title:"Tasa de titulaci贸n",children:[e.jsx(r,{ref:y,title:e.jsxs(e.Fragment,{children:[l.carrera.label," ",e.jsx("span",{style:{marginInline:"15px"}})," ",l.periodo.label]}),children:e.jsxs(m,{justify:"space-between",children:[e.jsx(c,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsxs(r,{children:[e.jsxs(r.Grid,{style:{width:"100%",backgroundColor:"#0161DA"},children:[e.jsx(p.Title,{style:{color:"white"},level:3,children:"Total de estudiantes titulados"}),e.jsxs(m,{justify:"space-between",children:[e.jsxs(p.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:[b.total_titulados.value," "]}),e.jsx(p.Text,{style:{color:"white",fontSize:"3em",fontWeight:"bold"},children:e.jsx(oe,{})})]})]}),u.map((o,t)=>e.jsxs(r.Grid,{style:{width:"50%",backgroundColor:"white",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(p.Link,{children:o.label}),e.jsx(E,{title:"Cantidad de estudiantes",value:o.value}),e.jsx(E,{title:"Porcentaje de titulacion",value:parseFloat(o.value/b.total_titulados.value*100).toFixed(2)+"%"})]}))]})}),e.jsx(c,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(ie,{data:B,angleField:"value",colorField:"label"})})]})}),e.jsx(k,{dataSource:U,columns:T,style:{width:"100%",marginTop:"30px"}})]}):e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsx(c,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(F,{})}),e.jsx(c,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(F,{})})]}),e.jsx(k,{columns:T,style:{width:"100%",marginTop:"30px"}})]})]})};export{Fe as default};
